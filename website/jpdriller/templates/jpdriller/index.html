{% load static %}
<link rel='stylesheet' type='text/css' href='{% static "jpdriller/style.css" %}'/>

<script type="text/javascript">
var question;
var translation;
var pronounciation;
var group;

function getSelectedOptions(id) {
    return Array.from(document.querySelectorAll('#'+id+' option:checked')).map((el) => el.value);
}
    
function get_vocabulary(str) {
    var xhr = new XMLHttpRequest();
    var arr;
    var prnc;
    var trns;
    
    xhr.open('GET','get_vocabulary?groups='+str);
    xhr.onload = function() {
        if(xhr.readyState === 4 && xhr.status === 200) {
            arr = xhr.responseText.split(',');

            if(arr[0] == 0) {
                question  = arr[1];
                pronounciation = arr[2];
                translation = arr[3];
                document.getElementById('response').style.fontSize = 'x-large';
            } else {
                question  = arr[3];
                pronounciation = '';
                translation = arr[1];
                document.getElementById('response').style.fontSize = 'medium';
            }
            document.getElementById('response').innerHTML = '<b><h1>'+question+'</h1></b>';
            document.getElementById('note').innerHTML = '<b><p>'+arr[4]+'</p></b>';
            group = arr[5]
            
            prnc = document.getElementById('pronounciation');
            trns = document.getElementById('translation');
            
            document.getElementById('helptext').innerHTML = '';
            
            if(pronounciation != '') {prnc.style.visibility = 'visible';}
            else                     {prnc.style.visibility = 'hidden';}
            if(translation != '')    {trns.style.visibility = 'visible';}
            else                     {trns.style.visibility = 'hidden';}
            if(pronounciation != '' || translation != '') {
                document.getElementById('helpbutton').style.visibility = 'visible';
            }
            
            if(pronounciation != '' && translation != '') {prnc.focus();} 
            else if(pronounciation != "") {prnc.focus();} 
            else {trns.focus();}
        }
        else {alert('Request failed ' + xhr.status);}
    };
    xhr.send();
}
    
window.onload=function()
{
    var prnc = document.getElementById('pronounciation');
    var trns = document.getElementById('translation');
    var hlpt = document.getElementById('helptext');
    var hlpb = document.getElementById('helpbutton');
    
    prnc.style.visibility = 'hidden';
    trns.style.visibility = 'hidden';
    hlpb.style.visibility = 'hidden';

    document.getElementById('groups').onchange = function() {
        var groups = getSelectedOptions('groups');
        
        if(document.getElementById('response').innerHTML == ''  || !groups.includes(group)) {
            if(groups != "") {get_vocabulary(groups);} 
            else {
                translation = '';
                pronounciation = '';
                document.getElementById('response').innerHTML = '';
                document.getElementById('note').innerHTML = '';
                hlpt.innerHTML = '';
                prnc.style.visibility = 'hidden';
                trns.style.visibility = 'hidden';
                hlpb.style.visibility = 'hidden';
            }
        }
    };

    hlpb.onclick = function() {
        hlpt.innerHTML = pronounciation +' : '+ translation;
    };
    
    prnc.oninput = function() {
        if (prnc.value == pronounciation && trns.value == translation) {
            prnc.value = '';
            trns.value = '';
            hlpt.innerHTML = '';
            get_vocabulary(getSelectedOptions('groups'));
        }
    };
    
    trns.oninput = function() {
        if (prnc.value == pronounciation && trns.value == translation) {
            prnc.value = '';
            trns.value = '';
            hlpt.innerHTML = '';
            get_vocabulary(getSelectedOptions('groups'));
        }
    };
}
</script>

<div id="wrapper">

    <div id="group-container">
        <b><label id="grouplabel">Groups:</label></b>
        </br>
        <select id="groups" multiple>
            {% for group in groups %}
                <option value="{{group.group}}">{{group.group}}</option>
            {% endfor %}
        </select>
    </div>

    <div id="inner-container-right">
    
        <div id="response-container">
            <span id="response"></span>
            <span id="note"></span>
            <span id="helptext"></span>
        </div>

        <div id="input-container">
            <input type="text" id="pronounciation" name="pronounciation" placeholder="Pronounciation"/>
            </br>
            <input type="text" id="translation" name="translation" placeholder="Translation"/>
            </br>
            </br>
            <input type="button" name="help" value="help" id="helpbutton">
        </div>
        
    </div>
    
</div>